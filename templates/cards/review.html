{% extends 'base.html' %}
{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-xl shadow-md p-6">
        <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h2>
        
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ -->
        <div class="text-center mb-6">
            <div class="text-2xl font-bold text-gray-800 mb-4 flex items-center justify-center gap-3">
                {% if show_word %}
                    {{ card.word }}
                    <button onclick="playTTS({{ card.id }})" title="–û–∑–≤—É—á–∏—Ç—å" class="text-blue-400 hover:text-blue-600 focus:outline-none transition">
                        <span class="text-2xl">‚ñ∂Ô∏è</span>
                    </button>
                {% else %}
                    {{ card.translation }}
                    <button onclick="playTTS({{ card.id }}, 'translation')" title="–û–∑–≤—É—á–∏—Ç—å" class="text-blue-400 hover:text-blue-600 focus:outline-none transition">
                        <span class="text-2xl">‚ñ∂Ô∏è</span>
                    </button>
                {% endif %}
            </div>
            
            <div class="text-lg text-gray-600 mb-3">
                {% if show_word %}{{ card.translation }}{% else %}{{ card.word }}{% endif %}
            </div>
            
            {% if card.example %}
                <div class="text-sm text-gray-500 mb-2 italic">"{{ card.example }}"</div>
            {% endif %}
            
            {% if card.comment %}
                <div class="text-xs text-gray-400 mb-3">{{ card.comment }}</div>
            {% endif %}
            
            <div class="inline-block px-3 py-1 bg-gray-100 rounded text-sm text-gray-600">
                {{ card.get_level_display }}
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ -->
        <div class="text-center mb-6">
            <a href="{% url 'review_mode' %}" class="px-4 py-2 bg-gray-400/80 text-white rounded shadow hover:bg-gray-500 transition font-medium">
                üîÑ –°–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º
            </a>
        </div>
        
        <!-- –û—Ü–µ–Ω–∫–∞ -->
        <form method="post" class="space-y-4">
            {% csrf_token %}
            <div class="text-center">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">–û—Ü–µ–Ω–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –≤—ã –∑–Ω–∞–µ—Ç–µ —ç—Ç–æ —Å–ª–æ–≤–æ:</h3>
                <div class="grid grid-cols-6 gap-2">
                    {% for i in "012345" %}
                        <button name="quality" value="{{ i }}" type="submit" 
                                class="px-4 py-3 bg-blue-400/80 text-white rounded shadow hover:bg-blue-500 transition font-bold text-lg">
                            {{ i }}
                        </button>
                    {% endfor %}
                </div>
                <div class="text-sm text-gray-500 mt-3">
                    <span class="font-medium">0</span> ‚Äî –Ω–µ –∑–Ω–∞–ª, 
                    <span class="font-medium">5</span> ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ
                </div>
            </div>
        </form>
    </div>
</div>

<script>
function playTTS(cardId, field) {
    const audio = new Audio();
    let url = `/cards/${cardId}/tts/?field=` + (field || 'word');
    audio.src = url;
    
    audio.addEventListener('error', function(e) {
        console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ:', e);
        showNotification('–û—à–∏–±–∫–∞ –æ–∑–≤—É—á–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
    });
    
    audio.addEventListener('loadstart', function() {
        console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ...');
    });
    
    audio.addEventListener('canplay', function() {
        console.log('–ê—É–¥–∏–æ –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é');
    });
    
    audio.play().catch(function(error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞—É–¥–∏–æ:', error);
        showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞—É–¥–∏–æ.', 'error');
    });
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-4 py-3 rounded shadow-lg z-50 max-w-sm ${
        type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'
    }`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}
</script>
{% endblock %} 