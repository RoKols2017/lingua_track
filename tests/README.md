# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ LinguaTrack

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ LinguaTrack.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py              # –ü–∞–∫–µ—Ç —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ conftest.py              # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ utils.py                 # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ test_sm2.py             # –¢–µ—Å—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞ SM-2
‚îú‚îÄ‚îÄ test_models.py          # –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π Django
‚îú‚îÄ‚îÄ test_speechkit.py       # –¢–µ—Å—Ç—ã Yandex SpeechKit
‚îú‚îÄ‚îÄ test_api.py             # –¢–µ—Å—Ç—ã API endpoints
‚îú‚îÄ‚îÄ test_forms.py           # –¢–µ—Å—Ç—ã —Ñ–æ—Ä–º Django
‚îú‚îÄ‚îÄ test_bot.py             # –¢–µ—Å—Ç—ã Telegram-–±–æ—Ç–∞
‚îú‚îÄ‚îÄ test_integration.py     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
pytest
```

### –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
```bash
pytest --cov=. --cov-report=html
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
```bash
# –¢–µ—Å—Ç—ã SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º–∞
pytest tests/test_sm2.py

# –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π
pytest tests/test_models.py

# –¢–µ—Å—Ç—ã —Å –º–∞—Ä–∫–µ—Ä–æ–º
pytest -m sm2
pytest -m models
pytest -m integration
```

### –ó–∞–ø—É—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
```bash
pytest -m slow
```

## ü™ü Windows-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bat-—Ñ–∞–π–ª–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```cmd
# –¢–µ—Å—Ç—ã SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º–∞
.\run_tests.bat --sm2

# –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π
.\run_tests.bat --models

# –í—Å–µ —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
.\run_tests.bat --coverage

# –í—Å–µ —Ç–µ—Å—Ç—ã
.\run_tests.bat --all
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PowerShell
```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫
$env:DJANGO_SETTINGS_MODULE="lingua_track.settings"; pytest tests/test_sm2.py

# –ò–ª–∏ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
$env:DJANGO_SETTINGS_MODULE="lingua_track.settings"; python -m pytest tests/test_sm2.py -v
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Python —Å–∫—Ä–∏–ø—Ç–∞
```cmd
# –¢–µ—Å—Ç—ã SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º–∞
python run_tests.py --sm2

# –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π
python run_tests.py --models

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
python run_tests.py --coverage
```

## üè∑ –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

- `@pytest.mark.unit` - –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `@pytest.mark.integration` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `@pytest.mark.slow` - –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `@pytest.mark.api` - API —Ç–µ—Å—Ç—ã
- `@pytest.mark.models` - –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π
- `@pytest.mark.sm2` - –¢–µ—Å—Ç—ã SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º–∞
- `@pytest.mark.speechkit` - –¢–µ—Å—Ç—ã SpeechKit
- `@pytest.mark.bot` - –¢–µ—Å—Ç—ã Telegram-–±–æ—Ç–∞

## üéØ –¶–µ–ª–∏ –ø–æ–∫—Ä—ã—Ç–∏—è

- **SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º:** 100%
- **–ú–æ–¥–µ–ª–∏:** 95%
- **SpeechKit:** 90%
- **API:** 85%
- **–§–æ—Ä–º—ã:** 80%
- **Telegram-–±–æ—Ç:** 75%
- **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 80%+

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º:
1. –û—Ç–∫—Ä–æ–π—Ç–µ `htmlcov/index.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ø–æ–∫—Ä—ã—Ç–∏—é
3. –ù–∞–π–¥–∏—Ç–µ –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã–µ —É—á–∞—Å—Ç–∫–∏ –∫–æ–¥–∞

## üîß –§–∏–∫—Å—Ç—É—Ä—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
- `user` - –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `user_with_telegram` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å Telegram ID
- `card` - –¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
- `schedule` - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
- `client` - Django —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
- `authenticated_client` - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç

### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
- `multiple_cards` - –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç–æ—á–µ–∫
- `due_cards` - –ö–∞—Ä—Ç–æ—á–∫–∏ –≥–æ—Ç–æ–≤—ã–µ –∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—é
- `future_cards` - –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
- `mock_speechkit_settings` - –ú–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ SpeechKit
- `sample_csv_file` - –¢–µ—Å—Ç–æ–≤—ã–π CSV —Ñ–∞–π–ª

## üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç SM-2 –∞–ª–≥–æ—Ä–∏—Ç–º–∞
```python
def test_unsuccessful_answer_resets_schedule(schedule_with_history):
    """–¢–µ—Å—Ç —Å–±—Ä–æ—Å–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–º –æ—Ç–≤–µ—Ç–µ."""
    schedule = schedule_with_history
    
    # –ù–µ—É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
    update_schedule(schedule, 2)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–±—Ä–æ—Å
    assert schedule.repetition == 0
    assert schedule.interval == 1
    assert schedule.last_result is False
```

### –¢–µ—Å—Ç –º–æ–¥–µ–ª–∏
```python
def test_card_creation(user):
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏."""
    card = Card.objects.create(
        user=user,
        word='hello',
        translation='–ø—Ä–∏–≤–µ—Ç'
    )
    
    assert card.word == 'hello'
    assert card.translation == '–ø—Ä–∏–≤–µ—Ç'
    assert hasattr(card, 'schedule')
```

### –¢–µ—Å—Ç API
```python
def test_cards_list_api(authenticated_client, card):
    """–¢–µ—Å—Ç API –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫."""
    response = authenticated_client.get('/api/cards/')
    
    assert response.status_code == 200
    data = response.json()
    assert len(data) == 1
    assert data[0]['word'] == 'hello'
```

## üêõ –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ü–æ–∫–∞–∑–∞—Ç—å –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```bash
pytest -v -s
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
```bash
pytest -x
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
```bash
pytest tests/test_sm2.py::TestSM2Algorithm::test_unsuccessful_answer_resets_schedule
```

### –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
```bash
pytest --tb=long
```

## üîÑ CI/CD

–¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏:
- Push –≤ main –≤–µ—Ç–∫—É
- Pull Request
- Release

### GitHub Actions
```yaml
- name: Run tests
  run: |
    pip install -r requirements.txt
    pytest --cov=. --cov-report=xml
```

## üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞** –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º –º–æ–¥—É–ª–µ
2. **–î–æ–±–∞–≤—å—Ç–µ –º–∞—Ä–∫–µ—Ä—ã** –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã** –∏–∑ conftest.py
4. **–ù–∞–ø–∏—à–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –¥–ª—è —Ç–µ—Å—Ç–∞
5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

### –ü—Ä–∏–º–µ—Ä –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
```python
@pytest.mark.models
def test_new_feature(user):
    """–¢–µ—Å—Ç –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏."""
    # Arrange
    card = create_test_card(user, word='new', translation='–Ω–æ–≤—ã–π')
    
    # Act
    result = card.new_method()
    
    # Assert
    assert result == expected_value
```

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞** –¥–ª—è —Ç–µ—Å—Ç–æ–≤
2. **–°–ª–µ–¥—É–π—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—É AAA** (Arrange, Act, Assert)
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã** –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
5. **–ú–æ–∫–∞–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
6. **–ü–∏—à–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
7. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –≤—ã—Å–æ–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** –∫–æ–¥–∞

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É pytest
pip install pytest pytest-django

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Django
python manage.py check
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "Database access not allowed" (Windows)
```cmd
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ bat-—Ñ–∞–π–ª (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
.\run_tests.bat --sm2

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ PowerShell
$env:DJANGO_SETTINGS_MODULE="lingua_track.settings"; pytest tests/test_sm2.py

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Python —Å–∫—Ä–∏–ø—Ç
python run_tests.py --sm2
```

### –ü—Ä–æ–±–ª–µ–º–∞: "ImportError while loading conftest" (Windows)
```cmd
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
echo %DJANGO_SETTINGS_MODULE%

# –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ bat-—Ñ–∞–π–ª
.\run_tests.bat --sm2
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ—Ç—á–µ—Ç–æ–º
pytest --cov=. --cov-report=term-missing

# –ù–∞–π–¥–∏—Ç–µ –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
pytest --cov=. --cov-report=html
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "not slow"

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
pytest -n auto
``` 